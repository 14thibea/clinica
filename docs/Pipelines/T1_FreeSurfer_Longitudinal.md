# `t1-freesurfer-longitudinal` – FreeSurfer-based longitudinal processing of T1-weighted MR images

This pipeline processes a series of images acquired at different time points for the same subject with the longitudinal FreeSurfer stream [[Reuter et al., 2012](http://dx.doi.org/10.1016/j.neuroimage.2012.02.084)] to increase the accuracy of volume and thickness estimates. It does so in a single command consisting of two consecutive steps:

- **Template creation** This corresponds to the [FreeSurfer `recon-all -base`](https://surfer.nmr.mgh.harvard.edu/fswiki/LongitudinalProcessing) command. It is executed on the subject to produce an unbiased template image using robust and inverse consistent registration [[Reuter et al., 2010](http://dx.doi.org/10.1016/j.neuroimage.2010.07.020)].

- **Longitudinal correction** This template is then used as an initialization to a sequence of processing steps triggered by the command [FreeSurfer `recon-all -long`](https://surfer.nmr.mgh.harvard.edu/fswiki/LongitudinalProcessing) to perform segmentation, extract surfaces and derive measurements at each time point.

## Prerequisites
The pipeline requires a prior run of the cross-sectional [`t1-freesurfer`](../T1_FreeSurfer) pipeline.

## Dependencies
If you only installed the core of Clinica, this pipeline needs the installation of **FreeSurfer 6.0** on your computer. You can find how to install this software on the [third-party](../../Third-party) page.

## Running the pipeline
The pipeline can be run with the following command line:

```
clinica run t1-freesurfer-longitudinal caps_directory
```

where:

  - `caps_directory` is the input/output folder containing the results in a [CAPS](../../CAPS/Introduction) hierarchy.
If you want to run the pipeline on a subset of your dataset, you can use the `-tsv` flag to specify in a TSV file the participants and the corresponding sessions of interest.


!!! note
    The computational time for one subject is around 10–15 hours (creation of the unbiased template) + 0-5 hours per corresponding session. The code execution speed depends on your CPU and the quality of your input T1 volumes. Please be aware that even though the pipeline runs in parallel, processing many subjects and sessions (e.g. ADNI dataset) is time consuming.


## Outputs
Results for the template creation are stored in the following folder of the [CAPS hierarchy](../../CAPS/Specifications/#t1-freesurfer-longitudinal-freesurfer-based-longitudinal-processing-of-t1-weighted-mr-images): `subjects/sub-<participant_label>/long-<long_label>/freesurfer_unbiased_template/sub-<participant_label>`, where <long_label> is an identifier defined by concatenating all the sessions associated with the current <participant_label> (e.g. if the template for participant `sub-01` is built from sessions `M00`, `M01`, `M05`, then <long_label> will be `M00M01M05`).
This folder contains the standard output structure of the `recon-all` command, i.e. folders such as `label/`, `mri/`, `surf/`, etc.

Results for the longitudinal processing are stored in the following folder of [CAPS hierarchy](../../CAPS/Specifications/#t1-freesurfer-longitudinal-freesurfer-based-longitudinal-processing-of-t1-weighted-mr-images):
`subjects/sub-<participant_label>/ses-<session_label>/t1/long-<long_label>/freesurfer_longitudinal/sub-<participant_label>_ses-<session_label>.long.sub-<participant_label>`.
Similar to the template creation folder, the longitudinal folder contains the standard output structure of the `recon-all` command (`label/`, `mri/`, `surf/`, etc.).

Among the files generated by FreeSurfer, you may be interested in the following outputs:

  - `*/mri/aseg.mgz`: subcortical segmentation volume
  - `*/mri/wm.mgz`: white matter mask
  - `*/mri/brainmask.mgz`: skull-stripped volume
  - `*/surf/?h.white`: white surface between white matter and gray matter (where `?h` stands for `lh` or `rh`)
  - `*/surf/?h.pial`: pial surface between gray matter and CSF
  (where `*` stands for `sub-<participant_label>_ses-<session_label>`)


More details regarding the `recon-all` output files can be found on the [FreeSurfer website](https://surfer.nmr.mgh.harvard.edu/fswiki/ReconAllOutputFiles).

!!! note
    The full list of features extracted from the FreeSurfer pipeline can be found in the [The ClinicA Processed Structure (CAPS) specifications](../../CAPS/Specifications/#t1-freesurfer-longitudinal-freesurfer-based-longitudinal-processing-of-t1-weighted-mr-images).

<!-- ## Visualization of the results

!!! note
    The visualization command is not available for the moment. Please come back later, this section will be updated ASAP. -->


## Describing this pipeline in your paper
!!! cite "Example of paragraph (short version):"
    These results have been obtained using the `t1-freesurfer-longitudinal` pipeline of Clinica. This pipeline is a wrapper of different tools of the FreeSurfer software (http://surfer.nmr.mgh.harvard.edu/) [[Fischl et al, 2012](http://dx.doi.org/10.1016/j.neuroimage.2012.01.021)]. This processing builds a subject-dependent template space and extracts volume and thickness estimates in this space at different points in time.

??? cite "Example of paragraph (long version):"
    These results have been obtained using the `t1-freesurfer-longitudinal` pipeline of Clinica. This pipeline is a wrapper of different tools of the FreeSurfer software [[Fischl et al, 2012](http://dx.doi.org/10.1016/j.neuroimage.2012.01.021)], which is documented and freely available for download online (http://surfer.nmr.mgh.harvard.edu/). The technical details of the procedures concerned with longitudinal analysis are described in prior publications [[Reuter et al, 2010](https://doi.org/10.1016/j.neuroimage.2010.07.020); [Reuter et al, 2011](http://dx.doi.org/10.1016/j.neuroimage.2011.02.076); [Reuter et al, 2012](http://dx.doi.org/10.1016/j.neuroimage.2012.02.084)]. The pipeline processes a series of images acquired at different time points for the same subject. It first produces an unbiased (with respect to any time point) template volume, and then, for each time point, uses the template as an initialisation (tailored to the subject) for the FreeSurfer cortical reconstruction process.

!!! tip
    Easily access the papers cited on this page on [Zotero](https://www.zotero.org/groups/2240070/clinica_aramislab/items/collectionKey/GHAXT4R5).

## Support

-   You can use the [Clinica Google Group](https://groups.google.com/forum/#!forum/clinica-user) to ask for help!
-   Report an issue on [GitHub](https://github.com/aramis-lab/clinica/issues).
